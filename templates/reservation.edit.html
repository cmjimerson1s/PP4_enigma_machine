{% extends "base.html" %}
{% load res_tags %}
{% block content %}
<div class="breadcrumbs d-flex align-items-center" style="background-image: url('assets/img/breadcrumbs-bg.jpg');">
  <div class="container position-relative d-flex flex-column align-items-center" data-aos="fade">
    <h2>Blog Posts</h2>
  </div>
</div>
<h1>Booking to Change:</h1>
{% for booking in booked_res %}
<h2>Date: {{booking.date}}</h2><h2>Time: {{booking.time_slot}}</h2><h2>Room: {{booking.room_choice}}</h2>
<form method = POST action="{% url 'account_booking_edit' %}">
    {% csrf_token %}
    <input type="date" name="new_date" min="{{today}}"><button type="submit">View Day</button>{{today}}{{new_date}}
    <input type="hidden" name="res_id" value="{{booking.id}}">
  </form>
<form id="deleteBookingForm" method="post" action="{% url 'delete_booking' %}">
  {% csrf_token %}
  <button id="deleteButton" type="button">Delete Booking</button>
  <input type="hidden" name="res_id" value="{{ booking.id }}">
</form>
{% if new_date %}
  {% with new_date as today %}
    {% for room in rooms %}
    <h1>{{room}}</h1>
      {% for time in times %}
        {% with bookings=reservations|res_date:today|res_room:room|res_time:time%}
          {% if bookings %}
          {% else %}
          <form method="POST" action="{% url 'account_booking_edit_confirm' %}">
            {% csrf_token %}
            <input type="hidden" name="new_date" value="{{today}}">
            <input type="hidden" name="picked_date" value="{{today}}">
            <input type="hidden" name="time" value="{{time}}">
            <input type="hidden" name="room" value="{{room}}">
            <input type="hidden" name="res_id" value="{{booking.id}}">
            <button type="submit" id="{{room}}-{{time}}-{{today}}">Available</button>
          </form>
          {% endif %}
        {% endwith%}
      {% endfor %}
    {% endfor %}
  {% endwith %}
  {% else %}
  {% for room in rooms %}
    <h1>{{room}}</h1>
      {% for time in times %}
        {% with bookings=reservations|res_date:booking.date|res_room:room|res_time:time%}
          {% if bookings %}
          {% else %}
          <form method="POST" action="{% url 'account_booking_edit_confirm' %}">
            {% csrf_token %}
            <input type="hidden" name="picked_date" value="{{today}}">
            <input type="hidden" name="time" value="{{time}}">
            <input type="hidden" name="room" value="{{room}}">
            <button type="submit" id="{{room}}-{{time}}-{{today}}">Available</button>
          </form>
          {% endif %}
        {% endwith%}
      {% endfor %}
    {% endfor %}
  {% endif %}
  {% endfor %}

    <a href="{% url 'account_overview' %}">Return to Account</a>

<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Confirm Booking Deletion</h2>
    <p>Are you sure you want to delete your booking?</p>
    <button id="confirmButton">Confirm</button>
    <button id="cancelButton">Cancel</button>
  </div>
</div>
    
<script>
      // Get the form element
      var form = document.getElementById('deleteBookingForm');
    
      // Get the delete button element
      var deleteButton = document.getElementById('deleteButton');
    
      // Get the modal element
      var modal = document.getElementById('myModal');
    
      // Get the close button element
      var closeButton = document.getElementsByClassName('close')[0];
    
      // Get the confirm and cancel buttons
      var confirmButton = document.getElementById('confirmButton');
      var cancelButton = document.getElementById('cancelButton');
    
      // When the delete button is clicked, display the modal
      deleteButton.addEventListener('click', function() {
        modal.style.display = 'block';
      });
    
      // When the close button is clicked or outside the modal, close the modal
      closeButton.addEventListener('click', function() {
        modal.style.display = 'none';
      });
    
      window.addEventListener('click', function(event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      });
    
      // When the confirm button is clicked, submit the form
      confirmButton.addEventListener('click', function() {
        form.submit();
      });
    
      // When the cancel button is clicked, close the modal
      cancelButton.addEventListener('click', function() {
        modal.style.display = 'none';
      });
</script>
{% endblock %}